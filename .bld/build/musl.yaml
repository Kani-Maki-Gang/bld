name: Build musl target
version: 2
runs_on:
  name: bld-musl-builder
  dockerfile: ${{ bld_root_dir }}/dockerfiles/musl/Dockerfile
  tag: latest

variables:
  branch: master

jobs:
  main:
    - name: Clone repository
      exec:
        - echo 'Cloning repository on branch ${{ branch }}'
        - git clone -b ${{ branch }} https://github.com/Kani-Maki-Gang/bld.git

    - name: Trunk build
      working_dir: ./bld/crates/bld_ui
      exec:
        - trunk build --release

    - name: Cargo build
      working_dir: ./bld
      exec:
        - cargo build --release --target x86_64-unknown-linux-musl

artifacts:
  - method: get
    from: ./bld/target/x86_64-unknown-linux-musl/release/bld
    to: dist/
    after: main
